{"generator":"Code Snippets v2.13.2","date_created":"2019-02-21 21:40","snippets":[{"name":"Delete Expired Coupons Automatically in WooCommerce","desc":"https:\/\/nicola.blog\/2018\/08\/01\/delete-expired-coupons-automatically\/","tags":["delete","expired","coupons","woocommerce","trash"],"scope":"admin","code":"add_action( 'init', 'schedule_delete_expired_coupons' );\r\n\r\n\/**\r\n * Trash all expired coupons when the event is triggered.\r\n *\/\r\nfunction delete_expired_coupons() {\r\n\t$args = array(\r\n\t\t'posts_per_page' => -1,\r\n\t\t'post_type'      => 'shop_coupon',\r\n\t\t'post_status'    => 'publish',\r\n\t\t'meta_query'     => array(\r\n\t\t\t'relation'   => 'AND',\r\n\t\t\tarray(\r\n\t\t\t\t'key'     => 'expiry_date',\r\n\t\t\t\t'value'   => current_time( 'Y-m-d' ),\r\n\t\t\t\t'compare' => '<='\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t'key'     => 'expiry_date',\r\n\t\t\t\t'value'   => '',\r\n\t\t\t\t'compare' => '!='\r\n\t\t\t)\r\n\t\t)\r\n\t);\r\n\r\n\t$coupons = get_posts( $args );\r\n\r\n\tif ( ! empty( $coupons ) ) {\r\n\t\t$current_time = current_time( 'timestamp' );\r\n\r\n\t\tforeach ( $coupons as $coupon ) {\r\n\t\t\twp_trash_post( $coupon->ID );\r\n\t\t}\r\n\t}\r\n}\r\nadd_action( 'delete_expired_coupons', 'delete_expired_coupons' );"}]}