<?xml version="1.0" encoding="UTF-8"?>
<!-- This is a code snippets export file generated by the Code Snippets WordPress plugin. -->
<!-- https://wordpress.org/plugins/code-snippets -->
<!-- To import these snippets a WordPress site follow these steps: -->
<!-- 1. Log in to that site as an administrator. -->
<!-- 2. Install the Code Snippets plugin using the directions provided at the above link. -->
<!-- 3. Go to 'Tools: Import' in the WordPress admin panel. -->
<!-- 4. Click on the "Code Snippets" importer in the list -->
<!-- 5. Upload this file using the form provided on that page. -->
<!-- 6. Code Snippets will then import all of the snippets and associated information contained in this file into your site. -->
<!-- 7. You will then have to visit the 'Snippets: All Snippets' admin menu and activate desired snippets. -->
<!-- generator="Code Snippets/2.8.6" created="2017-08-30 16:31" -->
<snippets>
  <snippet scope="1">
    <name>First name and full name user search in wp-admin</name>
    <desc></desc>
    <tags>user, search, first, name, full</tags>
    <code>/* version check */&#13;
global $wp_version;&#13;
&#13;
if(version_compare($wp_version,"4.1","&lt;")) {&#13;
	exit(__('User First Name / Full Name Search In WP-admin requires WordPress version 4.1 or higher. &#13;
				&lt;a href="http://codex.wordpress.org/Upgrading_Wordpress"&gt;Please update!&lt;/a&gt;', 'fullname-user-search-in-WP-admin'));&#13;
}&#13;
&#13;
// Plugin is build to be used only in wpadmin&#13;
if(is_admin()) {&#13;
	&#13;
&#13;
	// Action to inject custom search queries&#13;
    add_action('pre_user_query', 'empowering_user_search');	&#13;
&#13;
   // Main function responsible for enhancing the search&#13;
    function empowering_user_search($wp_user_query) {&#13;
        if(false === strpos($wp_user_query-&gt;query_where, '@') &amp;&amp; !empty($_GET["s"])) {&#13;
&#13;
            global $wpdb;&#13;
&#13;
            $uids=array();			&#13;
&#13;
			$flsiwa_add = "";&#13;
			// Escaped query string&#13;
			$qstr = esc_sql($_GET["s"]);&#13;
&#13;
			if(preg_match('/\s/',$qstr)){&#13;
				$pieces = explode(" ", $qstr);&#13;
				$user_ids_collector = $wpdb-&gt;get_results("SELECT DISTINCT user_id FROM $wpdb-&gt;usermeta WHERE (meta_key='first_name' AND LOWER(meta_value) LIKE '%".$pieces[0]."%')");&#13;
&#13;
	            foreach($user_ids_collector as $maf) {&#13;
	                if(strtolower(get_user_meta($maf-&gt;user_id, 'last_name', true)) == strtolower($pieces[1])){&#13;
						array_push($uids,$maf-&gt;user_id);&#13;
	                }&#13;
	            }&#13;
&#13;
			}else{				&#13;
&#13;
				$user_ids_collector = $wpdb-&gt;get_results("SELECT DISTINCT user_id FROM $wpdb-&gt;usermeta WHERE (meta_key='first_name' OR meta_key='last_name'".$flsiwa_add.") AND LOWER(meta_value) LIKE '%".$qstr."%'");&#13;
					foreach($user_ids_collector as $maf) {&#13;
	                array_push($uids,$maf-&gt;user_id);&#13;
	            }&#13;
			}&#13;
&#13;
            $users_ids_collector = $wpdb-&gt;get_results("SELECT DISTINCT ID FROM $wpdb-&gt;users WHERE LOWER(user_nicename) LIKE '%".$qstr."%' OR LOWER(user_email) LIKE '%".$qstr."%'");&#13;
&#13;
            foreach($users_ids_collector as $maf) {&#13;
                if(!in_array($maf-&gt;ID,$uids)) {&#13;
                    array_push($uids,$maf-&gt;ID);&#13;
                }&#13;
            }&#13;
&#13;
            $id_string = implode(",",$uids);&#13;
			if (!empty($id_string))&#13;
			{&#13;
	            $wp_user_query-&gt;query_where = str_replace("user_nicename LIKE '%".$qstr."%'", "ID IN(".$id_string.")", $wp_user_query-&gt;query_where);&#13;
			}&#13;
        }&#13;
        return $wp_user_query;&#13;
    }&#13;
}&#13;
&#13;
register_activation_hook(__FILE__,"fullname_user_search_in_wpadmin_activate");&#13;
&#13;
function fullname_user_search_in_wpadmin_activate() {&#13;
	register_uninstall_hook(__FILE__,"fullname_user_search_in_wpadmin_uninstall");&#13;
}&#13;
&#13;
function fullname_user_search_in_wpadmin_uninstall() {&#13;
	delete_option('flsiwa_meta_fields');&#13;
}</code>
  </snippet>
</snippets>
