{"generator":"Code Snippets v2.13.0","date_created":"2018-12-18 21:09","snippets":[{"name":"Restore CSV upload functionality for WordPress 4.9.9 and 5.0.1","desc":"https:\/\/gist.github.com\/rmpel\/e1e2452ca06ab621fe061e0fde7ae150\r\nhttps:\/\/wordpress.org\/news\/2018\/12\/wordpress-5-0-1-security-release\/","scope":"admin","code":"add_filter('wp_check_filetype_and_ext', function($values, $file, $filename, $mimes) {\r\n\tif ( extension_loaded( 'fileinfo' ) ) {\r\n\t\t\/\/ with the php-extension, a CSV file is issues type text\/plain so we fix that back to \r\n\t\t\/\/ text\/csv by trusting the file extension.\r\n\t\t$finfo     = finfo_open( FILEINFO_MIME_TYPE );\r\n\t\t$real_mime = finfo_file( $finfo, $file );\r\n\t\tfinfo_close( $finfo );\r\n\t\tif ( $real_mime === 'text\/plain' && preg_match( '\/\\.(csv)$\/i', $filename ) ) {\r\n\t\t\t$values['ext']  = 'csv';\r\n\t\t\t$values['type'] = 'text\/csv';\r\n\t\t}\r\n\t} else {\r\n\t\t\/\/ without the php-extension, we probably don't have the issue at all, but just to be sure...\r\n\t\tif ( preg_match( '\/\\.(csv)$\/i', $filename ) ) {\r\n\t\t\t$values['ext']  = 'csv';\r\n\t\t\t$values['type'] = 'text\/csv';\r\n\t\t}\r\n\t}\r\n\treturn $values;\r\n}, PHP_INT_MAX, 4);"}]}