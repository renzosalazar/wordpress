<?xml version="1.0" encoding="UTF-8"?>
<!-- This is a code snippets export file generated by the Code Snippets WordPress plugin. -->
<!-- https://wordpress.org/plugins/code-snippets -->
<!-- To import these snippets a WordPress site follow these steps: -->
<!-- 1. Log in to that site as an administrator. -->
<!-- 2. Install the Code Snippets plugin using the directions provided at the above link. -->
<!-- 3. Go to 'Tools: Import' in the WordPress admin panel. -->
<!-- 4. Click on the "Code Snippets" importer in the list -->
<!-- 5. Upload this file using the form provided on that page. -->
<!-- 6. Code Snippets will then import all of the snippets and associated information contained in this file into your site. -->
<!-- 7. You will then have to visit the 'Snippets: All Snippets' admin menu and activate desired snippets. -->
<!-- generator="Code Snippets/2.8.6" created="2017-06-27 16:07" -->
<snippets>
  <snippet scope="0">
    <name>Purge all expired transients by wp cron</name>
    <desc></desc>
    <tags>woocommerce, transients, cron, purge</tags>
    <code>// Schedule the CRON Job to purge all expired transients&#13;
&#13;
if (!wp_next_scheduled('purge_popup_transients_cron')) {&#13;
&#13;
	/**&#13;
	 * wp_schedule_event&#13;
	 *&#13;
	 * @param - When to start the CRON job&#13;
	 * @param - The interval in for each subsequent run&#13;
	 * @param - The name of the CRON JOB&#13;
	 */&#13;
&#13;
	wp_schedule_event( time(), 'daily', 'purge_popup_transients_cron');&#13;
}&#13;
&#13;
add_action( 'purg_transients_cron',  'purge_transients', 10 ,2);&#13;
&#13;
/**&#13;
 * Deletes all transients that have expired&#13;
 *&#13;
 * @access public&#13;
 * @static&#13;
 * @return void&#13;
 */&#13;
static function purge_popup_transients($older_than = '1 day', $safemode = true) {&#13;
&#13;
	global $wpdb;&#13;
	$older_than_time = strtotime('-' . $older_than);&#13;
&#13;
	/**&#13;
	 * Only check if the transients are older than the specified time&#13;
	 */&#13;
&#13;
	if ( $older_than_time &gt; time() || $older_than_time &lt; 1 ) {&#13;
		return false;&#13;
	}&#13;
&#13;
	/**&#13;
	 * Get all the expired transients&#13;
	 *&#13;
	 * @var mixed&#13;
	 * @access public&#13;
	 */&#13;
	$transients = $wpdb-&gt;get_col(&#13;
		$wpdb-&gt;prepare( "&#13;
				SELECT REPLACE(option_name, '_transient_timeout_', '') AS transient_name&#13;
				FROM {$wpdb-&gt;options}&#13;
				WHERE option_name LIKE '\_transient\_timeout\__%%'&#13;
					AND option_value &lt; %s&#13;
		", $older_than_time)&#13;
	);&#13;
&#13;
	/**&#13;
	 * If safemode is ON just use the default WordPress get_transient() function&#13;
	 * to delete the expired transients&#13;
	 */&#13;
&#13;
	if ( $safemode ) {&#13;
		foreach( $transients as $transient ) {&#13;
			get_transient($transient);&#13;
		}&#13;
	}&#13;
&#13;
	/**&#13;
	 * If safemode is OFF the just manually delete all the transient rows in the database&#13;
	 */&#13;
&#13;
	else {&#13;
		$options_names = array();&#13;
		foreach($transients as $transient) {&#13;
			$options_names[] = '_transient_' . $transient;&#13;
			$options_names[] = '_transient_timeout_' . $transient;&#13;
		}&#13;
		if ($options_names) {&#13;
			$options_names = array_map(array($wpdb, 'escape'), $options_names);&#13;
			$options_names = "'". implode("','", $options_names) ."'";&#13;
&#13;
			$result = $wpdb-&gt;query( "DELETE FROM {$wpdb-&gt;options} WHERE option_name IN ({$options_names})" );&#13;
			if (!$result) {&#13;
				return false;&#13;
			}&#13;
		}&#13;
	}&#13;
&#13;
	return $transients;&#13;
}</code>
  </snippet>
</snippets>
